# 実装計画: Workout Tracker

## 概要

本実装計画は、モバイルとPCで動作する筋トレメモアプリ「Workout Tracker」を段階的に構築します。React + TypeScript + Viteを使用し、オフラインファースト、パフォーマンス優先、アクセシビリティ準拠の原則に従います。

## 実装言語

TypeScript (React)

## タスク

- [x] 1. プロジェクトセットアップと基盤構築
  - Vite + React + TypeScript プロジェクトを初期化
  - 必要な依存関係をインストール（Zustand、Dexie.js、React Router、Chart.js、fast-check等）
  - ディレクトリ構造を作成（components、stores、services、hooks、utils）
  - デザイントークン（CSS Variables）を定義
  - グローバルスタイルとリセットCSSを設定
  - _要件: 8.9（モダンデザイン）、11（パフォーマンス）_

- [x] 2. データ層の実装
  - [x] 2.1 IndexedDBスキーマとDexie.js設定
    - WorkoutDatabaseクラスを実装
    - テーブル定義（workouts、presets、profile、images、syncQueue）
    - _要件: 1.2、2.1、5.2、6.4_
  
  - [x] 2.2 データ層のプロパティテスト
    - **プロパティ 1: トレーニング記録のラウンドトリップ**
    - **検証: 要件 1.2**
  
  - [x] 2.3 データ層のプロパティテスト
    - **プロパティ 5: プリセット更新のラウンドトリップ**
    - **検証: 要件 2.3**
  
  - [x] 2.4 データ層のプロパティテスト
    - **プロパティ 20: プロファイル更新のラウンドトリップ**
    - **検証: 要件 5.2**

- [x] 3. バリデーションとビジネスロジック
  - [x] 3.1 入力バリデーション関数の実装
    - トレーニング記録のバリデーション（必須フィールド、数値範囲）
    - プロファイルのバリデーション（身長、体重、週頻度の範囲）
    - _要件: 1.3、5.3_
  
  - [x] 3.2 バリデーションのプロパティテスト
    - **プロパティ 2: 無効な入力の拒否**
    - **検証: 要件 1.3**
  
  - [x] 3.3 バリデーションのプロパティテスト
    - **プロパティ 21: プロファイル入力の妥当性検証**
    - **検証: 要件 5.3**
  
  - [x] 3.4 RM計算ロジックの実装
    - Epley式による1RM計算
    - パーセンテージ計算（50%, 60%, 70%, 80%, 90%）
    - 結果のフォーマット（小数点第1位）
    - _要件: 3C.2、3C.3、3C.4、3C.5_
  
  - [x] 3.5 RM計算のプロパティテスト
    - **プロパティ 15: RM計算の数学的正確性**
    - **検証: 要件 3C.2**
  
  - [x] 3.6 RM計算のプロパティテスト
    - **プロパティ 16: RM計算結果のフォーマット**
    - **検証: 要件 3C.3**
  
  - [x] 3.7 RM計算のプロパティテスト
    - **プロパティ 17: RMパーセンテージ計算の正確性**
    - **検証: 要件 3C.4**
  
  - [x] 3.8 RM計算のプロパティテスト
    - **プロパティ 18: RM計算の無効入力拒否**
    - **検証: 要件 3C.5**

- [x] 4. 状態管理（Zustand Stores）
  - [x] 4.1 workoutStoreの実装
    - トレーニング記録のCRUD操作
    - フィルタリング機能（部位、日付範囲）
    - _要件: 1.1、1.2、4.3、4.4_
  
  - [x] 4.2 presetStoreの実装
    - プリセットのCRUD操作
    - プリセットからフォームへの自動入力
    - _要件: 2.1、2.2、2.3、2.4_
  
  - [x] 4.3 profileStoreの実装
    - プロファイルの作成・更新
    - _要件: 5.1、5.2_
  
  - [x] 4.4 imageStoreの実装
    - 画像のアップロード・保存・取得
    - _要件: 3A.1、3A.2、3A.5_
  
  - [x] 4.5 syncStoreの実装
    - 同期ステータス管理
    - オフライン時のキューイング
    - _要件: 6.4、9.1_

- [x] 5. チェックポイント - データ層とロジックの検証
  - すべてのテストが通ることを確認
  - ユーザーに質問があれば確認

- [x] 6. 画像処理機能
  - [x] 6.1 画像アップロードと圧縮
    - browser-image-compressionを使用した画像圧縮
    - 最大1920px幅へのリサイズ
    - サムネイル生成
    - _要件: 3A.2、3A.3、3A.4_
  
  - [x] 6.2 画像処理のプロパティテスト
    - **プロパティ 10: 画像形式の受け入れ**
    - **検証: 要件 3A.2**
  
  - [x] 6.3 画像処理のプロパティテスト
    - **プロパティ 11: 画像リサイズの制約**
    - **検証: 要件 3A.3**
  
  - [x] 6.4 画像処理のプロパティテスト
    - **プロパティ 12: 画像保存のラウンドトリップ**
    - **検証: 要件 3A.5**
  
  - [x] 6.5 画像シェア機能
    - Web Share API統合
    - フォールバック（ダウンロード）
    - シェアテキスト生成
    - _要件: 3B.1、3B.2、3B.3、3B.4、3B.5_
  
  - [x] 6.6 シェア機能のプロパティテスト
    - **プロパティ 13: シェアテキストの完全性**
    - **検証: 要件 3B.4**
  
  - [x] 6.7 シェア機能のプロパティテスト
    - **プロパティ 14: プライバシー設定時の個人情報除外**
    - **検証: 要件 3B.5**

- [x] 7. レイアウトコンポーネント
  - [x] 7.1 AppLayoutコンポーネント
    - レスポンシブレイアウト（モバイル/デスクトップ切り替え）
    - 広告スペースの確保（PC: 左右160px、モバイル: 下部60px）
    - _要件: 8.1、8.2、8.3、8.6、8.7_
  
  - [x] 7.2 ヘッダーとナビゲーション
    - 固定ヘッダー
    - ナビゲーションメニュー
    - _要件: 8.1、8.2_
  
  - [x] 7.3 共通UIコンポーネント
    - Button、Input、Select、Modal、Toast
    - アクセシビリティ対応（フォーカス、ARIAラベル）
    - _要件: 10.2、10.3、10.5_

- [x] 8. トレーニング記録機能
  - [x] 8.1 WorkoutFormコンポーネント
    - 入力フォーム（日付、部位、トレーニング方法、セット情報）
    - リアルタイムバリデーション
    - 画像アップロード統合
    - RM計算機能統合
    - _要件: 1.1、1.3、3A.1、3C.1_
  
  - [x] 8.2 WorkoutListコンポーネント
    - 記録一覧表示
    - フィルタリングUI
    - コピー機能
    - _要件: 3.1、3.2、4.3、4.4_
  
  - [x] 8.3 記録コピー機能のプロパティテスト
    - **プロパティ 7: 記録コピー時のデータ保持**
    - **検証: 要件 3.1**
  
  - [x] 8.4 記録コピー機能のプロパティテスト
    - **プロパティ 8: コピー時の日付自動設定**
    - **検証: 要件 3.2**
  
  - [x] 8.5 記録コピー機能のプロパティテスト
    - **プロパティ 9: コピー元の不変性**
    - **検証: 要件 3.3**
  
  - [x] 8.6 WorkoutCardコンポーネント
    - 個別記録の表示
    - 画像ギャラリー
    - シェアボタン
    - _要件: 3A.6、3B.1_
  
  - [x] 8.7 RMCalculatorコンポーネント
    - 重量・回数入力
    - 1RM計算と表示
    - パーセンテージ表示
    - 記録への自動入力
    - _要件: 3C.1、3C.2、3C.3、3C.4、3C.6_

- [x] 9. プリセット機能
  - [x] 9.1 PresetSelectorコンポーネント
    - プリセット一覧表示
    - プリセット選択とフォーム自動入力
    - _要件: 2.2_
  
  - [x] 9.2 プリセット機能のプロパティテスト
    - **プロパティ 3: プリセット作成時のデータ保持**
    - **検証: 要件 2.1**
  
  - [x] 9.3 プリセット機能のプロパティテスト
    - **プロパティ 4: プリセット選択時のフォーム自動入力**
    - **検証: 要件 2.2**
  
  - [x] 9.4 プリセット機能のプロパティテスト
    - **プロパティ 6: プリセット削除の完全性**
    - **検証: 要件 2.4**
  
  - [x] 9.5 プリセット管理UI
    - プリセット作成・編集・削除
    - 確認ダイアログ
    - _要件: 2.1、2.3、2.4_

- [x] 10. チェックポイント - コア機能の検証
  - すべてのテストが通ることを確認
  - 記録の作成・編集・削除が正常に動作することを確認
  - ユーザーに質問があれば確認

- [x] 11. データ可視化機能
  - [x] 11.1 ProgressChartコンポーネント
    - Chart.jsを使用した時系列グラフ
    - 軸選択（重量、回数、セット数、頻度）
    - _要件: 4.1、4.2_
  
  - [x] 11.2 ChartFiltersコンポーネント
    - 部位フィルター
    - トレーニング方法フィルター
    - 日付範囲フィルター
    - _要件: 4.3、4.4_
  
  - [x] 11.3 フィルタリング機能のプロパティテスト
    - **プロパティ 19: データフィルタリングの正確性**
    - **検証: 要件 4.3、4.4**
  
  - [x] 11.4 グラフのレンダリングパフォーマンス最適化
    - 1秒以内のレンダリング完了を確保
    - データポイントが多い場合の最適化
    - _要件: 4.5_

- [x] 12. プロファイル機能
  - [x] 12.1 ProfileFormコンポーネント
    - 身長、体重、週頻度の入力
    - バリデーション
    - _要件: 5.1、5.3_
  
  - [x] 12.2 ProfileSummaryコンポーネント
    - プロファイル表示
    - 編集ボタン
    - _要件: 5.2_

- [x] 13. 匿名データ共有と比較機能
  - [x] 13.1 データ匿名化サービス
    - ユーザーIDのハッシュ化
    - 個人情報の除外
    - _要件: 6.1、6.2、12.2_
  
  - [x] 13.2 匿名化のプロパティテスト
    - **プロパティ 22: 匿名データの個人情報除外**
    - **検証: 要件 6.1、6.2**
  
  - [x] 13.3 匿名化のプロパティテスト
    - **プロパティ 28: ユーザーIDハッシュ化の一方向性**
    - **検証: 要件 12.2**
  
  - [x] 13.4 同期サービス
    - データ送信
    - 失敗時のキューイング
    - バックグラウンド再送信
    - _要件: 6.3、6.4_
  
  - [x] 13.5 同期機能のプロパティテスト
    - **プロパティ 23: 同期失敗時のキューイング**
    - **検証: 要件 6.4**
  
  - [x] 13.6 類似ユーザー判定ロジック
    - 身長±5cm、体重±5kg、週頻度±1回の範囲判定
    - _要件: 7.2_
  
  - [x] 13.7 類似判定のプロパティテスト
    - **プロパティ 24: 類似ユーザー判定の範囲**
    - **検証: 要件 7.2**
  
  - [x] 13.8 統計計算サービス
    - 平均値、中央値、パーセンタイル計算
    - _要件: 7.3_
  
  - [x] 13.9 統計計算のプロパティテスト
    - **プロパティ 25: 統計計算の正確性**
    - **検証: 要件 7.3**
  
  - [x] 13.10 ComparisonChartコンポーネント
    - 比較データの表示
    - 統計情報の表示（平均、中央値、パーセンタイル）
    - データ不足時のメッセージ表示（10人未満）
    - _要件: 7.1、7.3、7.4_
  
  - [x] 13.11 比較フィルタリングのプロパティテスト
    - **プロパティ 26: 比較データのフィルタリング**
    - **検証: 要件 7.5**
  
  - [x] 13.12 比較データ取得API統合
    - 類似ユーザーデータの取得
    - キャッシング戦略
    - _要件: 7.1、7.2_

- [x] 14. オフライン対応とPWA
  - [x] 14.1 Service Worker設定（Workbox）
    - キャッシュ戦略の実装
    - オフライン時のフォールバック
    - バックグラウンド同期
    - _要件: 9.1、9.2、9.3、9.4_
  
  - [x] 14.2 オフライン機能のプロパティテスト
    - **プロパティ 27: オフライン時のローカル保存**
    - **検証: 要件 9.1**
  
  - [x] 14.3 PWAマニフェスト作成
    - アプリ名、アイコン、テーマカラー設定
    - インストール可能設定
    - スプラッシュスクリーン設定
    - _要件: 8.1、8.2_
  
  - [x] 14.4 オフライン状態の検知とUI
    - useOfflineStatusフックの実装
    - オフラインインジケーターの表示
    - 同期ステータスの表示
    - _要件: 9.1、9.3、9.4_

- [x] 15. チェックポイント - 全機能の統合検証
  - すべてのテストが通ることを確認
  - オフライン/オンライン切り替えが正常に動作することを確認
  - データ同期が正常に動作することを確認
  - ユーザーに質問があれば確認

- [x] 16. パフォーマンス最適化
  - [x] 16.1 コード分割とLazy Loading
    - React.lazyでルートベースの分割
    - 動的インポートの実装
    - Suspenseフォールバックの設定
    - _要件: 11.1、11.2_
  
  - [x] 16.2 画像最適化
    - WebP形式の優先使用
    - Lazy Loading属性の追加
    - レスポンシブ画像の実装
    - _要件: 11.3_
  
  - [x] 16.3 バンドルサイズ最適化
    - Tree Shakingの確認
    - 不要な依存関係の削除
    - バンドルアナライザーでの分析
    - _要件: 11.1、11.2_
  
  - [x] 16.4 Core Web Vitals測定と最適化
    - LCP（Largest Contentful Paint）を2.5秒以下に
    - FID（First Input Delay）を100ミリ秒以下に
    - CLS（Cumulative Layout Shift）を0.1以下に
    - _要件: 11.3、11.4、11.5_

- [x] 17. アクセシビリティ対応
  - [x] 17.1 キーボードナビゲーション
    - すべてのインタラクティブ要素にキーボードアクセス
    - フォーカス管理の実装
    - タブオーダーの最適化
    - _要件: 10.2、10.3_
  
  - [x] 17.2 ARIAラベルとセマンティックHTML
    - 適切なARIA属性の追加
    - セマンティックなHTML要素の使用
    - スクリーンリーダー対応
    - _要件: 10.5_
  
  - [x] 17.3 コントラスト比の検証
    - WCAG 2.1 AA準拠（4.5:1以上）
    - カラーパレットの検証
    - ダークモード対応
    - _要件: 10.4_
  
  - [x] 17.4 タッチターゲットサイズの確保
    - 最低44×44pxのサイズ確保
    - モバイルでのタップ領域最適化
    - _要件: 8.5_

- [x] 18. エラーハンドリングとロギング
  - [x] 18.1 ErrorHandlerクラスの実装
    - エラー分類とハンドリング
    - ユーザー通知（Toast）
    - リカバリー処理
    - _要件: 1.3、3A.3、3C.5、5.3_
  
  - [x] 18.2 エラーログの記録
    - ローカルストレージへの記録
    - 開発環境でのコンソール出力
    - エラー統計の収集
    - _要件: 全般_
  
  - [x] 18.3 グレースフルデグラデーション
    - ネットワーク障害時の対応
    - ストレージ不足時の対応
    - 画像処理失敗時の対応
    - _要件: 9.1、9.2、9.3、9.4_

- [x] 19. セキュリティとプライバシー
  - [x] 19.1 HTTPS通信の確保
    - すべてのAPI通信でHTTPSを使用
    - _要件: 12.1_
  
  - [x] 19.2 データ削除機能
    - ローカルデータの完全削除
    - サーバーへの削除リクエスト
    - _要件: 12.3_
  
  - [x] 19.3 プライバシー設定UI
    - データ共有の同意/拒否
    - プライバシーポリシーの表示
    - _要件: 6.3、12.4_

- [x] 20. 最終チェックポイント
  - すべてのテストが通ることを確認
  - パフォーマンス指標を測定（LCP、FID、CLS）
  - アクセシビリティツールで検証（Lighthouse、axe）
  - 各ブラウザでの動作確認（Chrome、Safari、Firefox）
  - モバイルデバイスでの実機テスト
  - ユーザーに最終確認

## 注意事項

- `*`マークのタスクはオプションで、より速いMVP開発のためにスキップ可能です
- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントで段階的な検証を行い、問題を早期に発見します
- プロパティテストは普遍的な正確性を検証し、ユニットテストは具体例とエッジケースを検証します
