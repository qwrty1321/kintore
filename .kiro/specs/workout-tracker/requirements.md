# 要件定義書

## はじめに

本文書は、モバイルブラウザとPCで動作する筋トレメモアプリケーション「Workout Tracker」の要件を定義します。ユーザーはトレーニング記録を入力・可視化し、匿名化されたデータを通じて他のユーザーと比較できます。

## 用語集

- **System**: Workout Tracker アプリケーション全体
- **User**: アプリケーションを使用してトレーニングを記録する人
- **Training_Record**: 日付、部位、トレーニング方法、回数、セット数、オプションで画像を含む記録
- **Preset**: ユーザーが保存した定型的なトレーニングセット
- **Body_Profile**: 身長、体重、トレーニング頻度を含むユーザーの身体情報
- **Anonymous_Data**: 個人を特定できない形式で共有されるトレーニングデータ
- **Comparison_Group**: 類似した身体プロファイルを持つユーザーのグループ
- **RM (Repetition Maximum)**: 特定の回数で挙上可能な最大重量。1RMは1回だけ挙上できる最大重量
- **Training_Image**: トレーニング記録に添付される画像（体型、フォーム、環境など）

## 要件

### 要件 1: トレーニング記録の入力

**ユーザーストーリー:** トレーニングを行うユーザーとして、日付、部位、トレーニング方法、回数、セット数を記録したい。そうすることで、自分の進捗を追跡できる。

#### 受入基準

1. WHEN ユーザーが新規記録を作成する THEN THE System SHALL 日付、部位、トレーニング方法、回数、セット数の入力フィールドを提供する
2. WHEN ユーザーが必須項目をすべて入力して保存する THEN THE System SHALL その記録をローカルストレージに永続化する
3. WHEN ユーザーが無効なデータ（負の数、空欄など）を入力する THEN THE System SHALL エラーメッセージを表示し、保存を拒否する
4. WHEN ユーザーが記録を保存する THEN THE System SHALL 200ミリ秒以内に保存を完了し、フィードバックを表示する

### 要件 2: プリセット機能

**ユーザーストーリー:** 定期的に同じトレーニングを行うユーザーとして、よく使うトレーニングセットをプリセットとして保存したい。そうすることで、毎回同じ内容を入力する手間を省ける。

#### 受入基準

1. WHEN ユーザーが既存の記録からプリセットを作成する THEN THE System SHALL その記録の部位、トレーニング方法、回数、セット数を保存する
2. WHEN ユーザーがプリセットを選択する THEN THE System SHALL 保存された値を入力フォームに自動入力する
3. WHEN ユーザーがプリセットを編集する THEN THE System SHALL 変更を保存し、以降の使用に反映する
4. WHEN ユーザーがプリセットを削除する THEN THE System SHALL 確認ダイアログを表示し、承認後に削除する

### 要件 3: 記録のコピー機能

**ユーザーストーリー:** 前回と同じトレーニングを行うユーザーとして、過去の記録をコピーして新しい記録を作成したい。そうすることで、入力時間を短縮できる。

#### 受入基準

1. WHEN ユーザーが過去の記録を選択してコピーする THEN THE System SHALL その記録のすべての項目を新しい記録フォームにコピーする
2. WHEN コピーされた記録が表示される THEN THE System SHALL 日付を現在日時に自動設定する
3. WHEN ユーザーがコピーした記録を編集する THEN THE System SHALL 元の記録に影響を与えずに新しい記録として保存する

### 要件 3A: トレーニング画像の記録

**ユーザーストーリー:** 自分の体型やフォームの変化を記録したいユーザーとして、トレーニング記録に画像を添付したい。そうすることで、視覚的に進捗を確認できる。

#### 受入基準

1. WHEN ユーザーがトレーニング記録を作成する THEN THE System SHALL 画像をアップロードするオプションを提供する
2. WHEN ユーザーが画像を選択する THEN THE System SHALL JPEG、PNG、WebP形式の画像を受け入れる
3. WHEN 画像がアップロードされる THEN THE System SHALL 画像を最大1920px幅にリサイズし、ファイルサイズを最適化する
4. WHEN ユーザーが1つの記録に複数の画像を添付する THEN THE System SHALL 最大5枚まで保存する
5. WHEN 画像が保存される THEN THE System SHALL ローカルストレージまたはIndexedDBに保存する
6. WHEN ユーザーが記録を表示する THEN THE System SHALL 添付された画像をサムネイルで表示し、タップ/クリックで拡大表示する

### 要件 3B: 画像のシェア機能

**ユーザーストーリー:** 自分の進捗を他の人と共有したいユーザーとして、トレーニング画像をSNSなどにシェアしたい。そうすることで、モチベーションを維持できる。

#### 受入基準

1. WHEN ユーザーが画像付き記録を表示する THEN THE System SHALL シェアボタンを提供する
2. WHEN ユーザーがシェアボタンをタップする THEN THE System SHALL Web Share APIを使用してネイティブシェアダイアログを表示する
3. WHEN Web Share APIが利用できない場合 THEN THE System SHALL 画像をダウンロードするオプションを提供する
4. WHEN 画像がシェアされる THEN THE System SHALL トレーニング情報（日付、部位、重量など）をテキストとして含める
5. WHEN ユーザーがプライバシー設定を有効にしている THEN THE System SHALL 個人を特定できる情報を除外する

### 要件 3C: Repetition Maximum (RM) 計算機能

**ユーザーストーリー:** 自分の最大挙上重量を知りたいユーザーとして、実施した重量と回数から1RMを計算したい。そうすることで、適切なトレーニング強度を設定できる。

#### 受入基準

1. WHEN ユーザーがトレーニング記録画面を表示する THEN THE System SHALL RM計算機能へのアクセスを提供する
2. WHEN ユーザーが重量と回数を入力する THEN THE System SHALL Epley式またはBrzycki式を使用して1RMを計算する
3. WHEN 1RMが計算される THEN THE System SHALL 結果を小数点第1位まで表示する
4. WHEN ユーザーが計算結果を表示する THEN THE System SHALL 50%、60%、70%、80%、90%の重量も併せて表示する
5. WHEN 無効な値（0以下の重量、30回を超える回数など）が入力される THEN THE System SHALL エラーメッセージを表示する
6. WHEN 計算結果が表示される THEN THE System SHALL その値を現在の記録に自動入力するオプションを提供する

### 要件 4: データ可視化

**ユーザーストーリー:** 自分の進捗を確認したいユーザーとして、記録をグラフで可視化したい。そうすることで、トレーニングの効果を視覚的に把握できる。

#### 受入基準

1. WHEN ユーザーがグラフ表示画面を開く THEN THE System SHALL 記録されたデータを時系列グラフで表示する
2. WHEN ユーザーが表示軸を選択する THEN THE System SHALL 重量、回数、セット数、トレーニング頻度から選択可能にする
3. WHEN ユーザーが特定の部位またはトレーニング方法でフィルタリングする THEN THE System SHALL 該当するデータのみをグラフに表示する
4. WHEN ユーザーが期間を指定する THEN THE System SHALL 指定された期間のデータのみを表示する
5. WHEN グラフが表示される THEN THE System SHALL 1秒以内にレンダリングを完了する

### 要件 5: 身体プロファイル管理

**ユーザーストーリー:** 他のユーザーと比較したいユーザーとして、自分の身長、体重、トレーニング頻度を登録したい。そうすることで、類似したユーザーとの比較が可能になる。

#### 受入基準

1. WHEN ユーザーが初回起動時にプロファイルを作成する THEN THE System SHALL 身長、体重、週あたりのトレーニング頻度の入力を求める
2. WHEN ユーザーがプロファイルを更新する THEN THE System SHALL 変更をローカルストレージに保存する
3. WHEN ユーザーが無効な値（負の数、極端な値など）を入力する THEN THE System SHALL 妥当な範囲を示すエラーメッセージを表示する

### 要件 6: 匿名データ共有

**ユーザーストーリー:** 他のユーザーと比較したいユーザーとして、自分のデータを匿名で共有したい。そうすることで、コミュニティ全体のデータプールに貢献できる。

#### 受入基準

1. WHEN ユーザーがデータ共有に同意する THEN THE System SHALL トレーニング記録と身体プロファイルを匿名化してサーバーに送信する
2. WHEN データが送信される THEN THE System SHALL 個人を特定できる情報（名前、メールアドレスなど）を含まない
3. WHEN ユーザーがデータ共有を無効にする THEN THE System SHALL 以降のデータ送信を停止する
4. WHEN データ送信が失敗する THEN THE System SHALL ローカルにキューイングし、次回接続時に再送信する

### 要件 7: 比較データの取得と表示

**ユーザーストーリー:** 自分と似た体型のユーザーの進捗を知りたいユーザーとして、類似ユーザーのデータを閲覧したい。そうすることで、自分のトレーニング計画の参考にできる。

#### 受入基準

1. WHEN ユーザーが比較画面を開く THEN THE System SHALL 類似した身体プロファイルを持つユーザーの集計データを取得する
2. WHEN 類似ユーザーが判定される THEN THE System SHALL 身長±5cm、体重±5kg、トレーニング頻度±1回/週の範囲で検索する
3. WHEN 比較データが表示される THEN THE System SHALL 平均値、中央値、パーセンタイルを含む統計情報を表示する
4. WHEN 類似ユーザーが10人未満の場合 THEN THE System SHALL プライバシー保護のため「データ不足」メッセージを表示する
5. WHEN ユーザーが特定のトレーニング方法で比較する THEN THE System SHALL その方法に関する類似ユーザーのデータのみを表示する

### 要件 8: レスポンシブデザインと広告スペース

**ユーザーストーリー:** モバイルとPCの両方を使用するユーザーとして、どのデバイスでも快適に使えるインターフェースが欲しい。そうすることで、場所を問わずアプリを利用できる。

#### 受入基準

1. WHEN ユーザーがモバイルデバイスでアクセスする THEN THE System SHALL タッチ操作に最適化されたUIを表示する
2. WHEN ユーザーがPCでアクセスする THEN THE System SHALL マウス操作に最適化されたUIを表示する
3. WHEN 画面サイズが変更される THEN THE System SHALL レイアウトを動的に調整する
4. THE System SHALL 320px以上のすべての画面幅で正常に動作する
5. WHEN タッチターゲットが表示される THEN THE System SHALL 最低44×44pxのサイズを確保する
6. WHEN ユーザーがPCでアクセスする THEN THE System SHALL 左右に広告スペース（各160-300px）を確保し、コンテンツエリアを中央に配置する
7. WHEN ユーザーがモバイルデバイスでアクセスする THEN THE System SHALL 下部に固定バナー広告スペース（50-90px）を確保し、コンテンツがその上に表示される
8. WHEN 広告スペースが表示される THEN THE System SHALL コンテンツの可読性とユーザビリティを損なわない
9. THE System SHALL モダンで洗練されたビジュアルデザインを採用する

### 要件 9: オフライン対応

**ユーザーストーリー:** ネットワーク接続が不安定な環境でトレーニングするユーザーとして、オフラインでも記録を入力したい。そうすることで、ジムなどの電波が弱い場所でも使用できる。

#### 受入基準

1. WHEN ユーザーがオフライン状態で記録を作成する THEN THE System SHALL ローカルストレージに保存する
2. WHEN ネットワーク接続が回復する THEN THE System SHALL 未送信のデータを自動的にサーバーに同期する
3. WHEN ユーザーがオフライン状態でグラフを表示する THEN THE System SHALL ローカルデータのみを使用して表示する
4. WHEN ユーザーがオフライン状態で比較データを要求する THEN THE System SHALL キャッシュされたデータを表示するか、接続が必要である旨を通知する

### 要件 10: アクセシビリティ

**ユーザーストーリー:** 視覚や運動機能に制約があるユーザーとして、支援技術を使ってアプリを操作したい。そうすることで、すべてのユーザーが平等にアプリを利用できる。

#### 受入基準

1. THE System SHALL WCAG 2.1 レベルAAに準拠する
2. WHEN ユーザーがキーボードで操作する THEN THE System SHALL すべての機能にキーボードでアクセス可能にする
3. WHEN フォーカスが移動する THEN THE System SHALL 視覚的なフォーカスインジケーターを表示する
4. THE System SHALL すべてのテキストと背景のコントラスト比を4.5:1以上にする
5. WHEN スクリーンリーダーが使用される THEN THE System SHALL 適切なARIAラベルとセマンティックHTMLを提供する

### 要件 11: パフォーマンス

**ユーザーストーリー:** 素早くデータを入力したいユーザーとして、アプリが高速に動作することを期待する。そうすることで、トレーニング中の休憩時間を有効活用できる。

#### 受入基準

1. WHEN ユーザーがアプリを初回読み込みする THEN THE System SHALL 3秒以内にインタラクティブになる
2. WHEN ユーザーがページ間を移動する THEN THE System SHALL 500ミリ秒以内に遷移を完了する
3. THE System SHALL Largest Contentful Paint (LCP) を2.5秒以下にする
4. THE System SHALL First Input Delay (FID) を100ミリ秒以下にする
5. THE System SHALL Cumulative Layout Shift (CLS) を0.1以下にする

### 要件 12: データセキュリティとプライバシー

**ユーザーストーリー:** 自分のデータを安全に管理したいユーザーとして、プライバシーが保護されることを期待する。そうすることで、安心してアプリを使用できる。

#### 受入基準

1. WHEN ユーザーデータがサーバーに送信される THEN THE System SHALL HTTPS通信を使用する
2. WHEN 匿名データが生成される THEN THE System SHALL ユーザーIDをハッシュ化し、元のIDを復元不可能にする
3. WHEN ユーザーがアカウントを削除する THEN THE System SHALL すべてのローカルデータを削除し、サーバーに削除リクエストを送信する
4. THE System SHALL ユーザーの明示的な同意なしに個人データを第三者と共有しない

